<!DOCTYPE html>
<html>
	<head>
	  <meta charset="utf-8" />
	  <title>Simplifeed</title>
	  <%= csrf_meta_tag %>
	  <%= stylesheet_link_tag "application", :media => "all" %>
	  <%= stylesheet_link_tag "http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css" %>
	  <%= javascript_include_tag "http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" %>
	  <%= javascript_include_tag "http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.0.3/bootstrap.min.js" %>
	  <script src="/js/jquery.ui.widget.js" type="text/javascript"></script>
	  <script src="/js/jquery.iframe-transport.js" type="text/javascript"></script>
	  <script src="/js/jquery.fileupload.js" type="text/javascript"></script>
	  <script src="/js/jquery.fileupload-ui.js" type="text/javascript"></script>
	  <%= javascript_include_tag "application" %>
	  <script src="http://js.pusher.com/1.11/pusher.min.js" type="text/javascript"></script>
	  <% if user_signed_in? %>
			<% @notifications = Notification.find(:all, :conditions => { :read => false, :user_id => current_user.id }) %>
			 <script>var event_id="notification-<%= current_user.id %>";</script>
	  <% end %>
	</head>
	
	<body class="<% controller.controller_name %>">
	  <div class="navbar">
		  <div class="navbar-inner">
		    <div class="container">
		    	<a class="brand" href="/">Simplifeed</a>
				<ul class="nav pull-right">
				  <% if user_signed_in? %>
				  	<li class="dropdown">
						    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
						          Chat
						          <% if @online_friends != nil && @online_friends.size > 0 %>
						          	<span id="message-count" class="badge badge-info"><%= @online_friends.size %></span>
						          <% else %>
						          	<span id="message-count" class="badge"><%= @online_friends.size %></span>
						          <% end %>
						          <b class="caret"></b>
						    </a>
						    <ul id="messages" class="dropdown-menu">
							    <% if @recent_friends && @recent_friends.size > 0 %>
								  <% @recent_friends.each do |recent_friend| %>
								  	<li>
								  		<a href="#">
								  			<%= recent_friend.username %> 
									  		<% if @online_friends.include? recent_friend.id %>
									  			<span class="label label-info pull-right">Online</span>
									  		<% end %>
								  		</a>
								  	</li>
								  <% end %>
								<% else %>
									<li class="empty">Nothing to see here.</li>
								<% end %>
						    </ul>
					    </li>
				  
					  	<li class="dropdown">
						    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
						          Notifications
						          <% if @notifications.size > 0 %>
						          	<span id="notification-count" class="badge badge-info"><%= @notifications.size %></span>
						          <% else %>
						          	<span id="notification-count" class="badge"><%= @notifications.size %></span>
						          <% end %>
						          <b class="caret"></b>
						    </a>
						    <ul id="notifications" class="dropdown-menu">
							    <% if @notifications.size > 0 %>
								  <% @notifications.each do |notification| %>
								  	<li><%= notification.message.html_safe %></li>
								  <% end %>
								<% else %>
									<li class="empty"><a>Nothing to see here.</a></li>
								<% end %>
						    </ul>
					    </li>
				  	
				    <li class="dropdown">
					    <a href="#"
					          class="dropdown-toggle"
					          data-toggle="dropdown">
					          <%= current_user.email %>
					          <b class="caret"></b>
					    </a>
					    <ul class="dropdown-menu">
					      <% @user==current_user %>
						  <li><%= link_to 'Edit Profile', edit_user_registration_path(@user) %></li>
						  <li><%= link_to "Manage Friends", '/friends' %></li>
					      <li><%= link_to "Sign Out", destroy_user_session_path, :method => :delete %></li>
					    </ul>
				    </li>
				    
				  <% else %>
				    <li><%= link_to "Sign in", new_user_session_path %></li>
				  <% end %>
				</ul>
		    </div>
		  </div>
	  </div>
	  <div id="container" class="container-fluid">
	    <div id="main" role="main">
	      <div class="row-fluid">
	      	<div id="growl-notifications" class="span12"></div>
	      </div>
	      <div class="row-fluid">
	      	<% if !flash.empty? %>
		      <div id="flash" class="span12 alert alert-<%= @alert_style %>">
		        <% flash.each do |key, value| %>
		          <div title="<%= key.to_s.humanize %>" class="<%= key %>">
		            <p><%= value %></p>
		          </div>
		        <% end %>
		      </div>
		    <% end %>
	      </div>
	      <%= yield %>
		  <div class="row-fluid">
		    <footer id="footer">
			    <div class="copyright">
			      Copyright &copy;
			      <a href="http://www.simplifeed.me/">Simplifeed</a>
			      <h5 id="footer-year"> <%= Date.today.year %></h5>
			    </div>
		    </footer>
		  </div>
	    </div>
	  </div>
	</body>
</html>